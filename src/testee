const weather = (() => {
    async function skydat(city) {
        const endsky = `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${city}?key=Q5B6SAGL9K9TLF33ZLACMBGX6`;
        try {
            const response = await fetch(endsky, { mode: 'cors' });
            if (!response.ok) throw new Error(`City ${city} response was not ok: ${response.status}`);
            
            const rawData = await response.json();
            console.log('FULL API RESPONSE:', rawData); // This will show us the actual structure
            
            // Let's also check specific parts
            console.log('Address:', rawData.address);
            console.log('Resolved Address:', rawData.resolvedAddress);
            console.log('Current Conditions:', rawData.currentConditions);
            
            if (rawData.currentConditions) {
                console.log('Temperature:', rawData.currentConditions.temp);
                console.log('Humidity:', rawData.currentConditions.humidity);
                console.log('Windspeed:', rawData.currentConditions.windspeed);
            }
            
            const data = convertsky(rawData);
            return data;
        } catch (error) {
            alert(`Weather data error: ${error.message}`);
            console.error('API Error:', error);
            return null;
        }
    }

    function convertsky(skyData) {
        // Let's make this more flexible while we debug
        return {
            citiname: skyData?.resolvedAddress || skyData?.address || 'Unknown',
            temp: skyData?.currentConditions?.temp ?? null,
            humidity: skyData?.currentConditions?.humidity ?? null,
            windSpeed: skyData?.currentConditions?.windspeed ?? null
        };
    }

    return { skydat };
})();